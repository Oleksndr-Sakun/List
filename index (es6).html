<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Document</title>
    <style>
    	ul {
    		border-bottom: 1px solid rgb(200,200,200);
    	}
        ul li {
            cursor: default;
            user-select: none;
            list-style-type: none;
        }
        .selected {
            background-color: #FF9700;
        }
        input {
			padding: 5px 10px;
			border-radius: 5px;
			border-style: solid;
			border-width: 1px;
			margin-right: 5px;
        }
        input:focus {
        	outline: none;
        	box-shadow: 0 0 3px rgb(30,30,30) inset;
        }
        input[type="text"] {
			margin-right: 10px;
        }
        
    </style>
</head>
<body>
    <div id="container">

    </div>
    <script>
       'use strict';
        let create = document.createElement.bind(document);
        class List {
            constructor(items, conatainer) {
                this.container = container;
                this.createModel(items);
            }

            // model
            createModel(data) {
               this.model = data.map(elem => {
                  return this.createItem(elem);
               });
            }
            getData() {
                return this.model;
            }
            validateData(data) {
                return data ? true : false;
            }
            createItem(item) {
                return {
                         title: item,
                         isSelected: false,
                         visible: true
                       }
            }
            addItem(item) {
                this.model.push(item);
            }
            removeData() {
                this.model = this.model.filter((a, i) => !this.selected.includes(i));
            }
            selectData(item) {
                item.isSelected = true;
            }
            cancelLastSelected() {
               this.model.find(elem => {return elem.isLastSelected;})
                   .isLastSelected = false;
            }
            cancelSelectionAll() {
                this.model.forEach(elem => {
                    if (elem.isSelected) elem.isSelected = false;
                });
            }

            // controller

            // devide action handler, for handlers using bind via () => {}
            actionHandler(e)  {
                e.preventDefault();
                if (e.target.tagName === 'LI') {
                    let listArr = [].slice.call(this.ul.children);
                    let targetIndex = listArr.indexOf(e.target);
                    if (e.shiftKey) {
                        this.parseShiftClick(this.model[targetIndex]);
                    } else if (e.ctrlKey) {
                        this.parseCtrlClick(this.model[targetIndex]);
                    } else {
                        this.parseClick(this.model[targetIndex]);
                    }
                } else if (e.target === this.buttonAdd) {
                    if (this.validateData(this.textBox.value)) {
                        this.addData(this.textBox.value);
                    }
                } else if (e.target === this.buttonRemove) {
                    if (this.model.some(elem => {return elem.isLastSelected;})) {
                        this.model = this.model.filter(elem => {
                             return !elem.isSelected;
                        });
                    }
                }
                this.render(this.model);
            }
            parseClick(item) {
                this.cancelSelectionAll();
                this.selectData(item);
                item.isLastSelected = true;
            }
            parseCtrlClick(item) {
                if (item.isSelected) {
                    item.isSelected = false;
                    this.cancelLastSelected();
                } else {
                    item.isSelected = true;
                    item.isLastSelected = true;
                }
            }
            parseShiftClick(item) {
                let last = this.model.findIndex(elem => {return elem.isLastSelected;});
                this.cancelSelectionAll();
                if (last !== -1) {
                    let min = Math.min(last, this.model.indexOf(item));
                    let max = Math.max(last, this.model.indexOf(item));
                    for (let i = min; i <= max; i++) {
                        this.model[i].isSelected = true;
                    }
                } else {
                    item.isLastSelected = true;
                    item.isSelected = true;
                }
            }

            // view
            preRender() {
                this.ul = create('ul');
                this.form = create('form');
                this.textBox = create('input');
                this.textBox.setAttribute('type', 'text');
                this.buttonAdd = create('input');
                this.buttonAdd.setAttribute('type', 'submit');
                this.buttonAdd.setAttribute('value', 'add');
                this.buttonRemove = create('input');
                this.buttonRemove.setAttribute('type', 'button');
                this.buttonRemove.setAttribute('value', 'remove');
                this.ul.onclick = this.actionHandler;
                this.form.onclick = this.actionHandler;
                this.form.append(this.textBox, this.buttonAdd, this.buttonRemove);
                this.container.append(this.form, this.ul);
            }
            // for rendering using appendChild
            render(model) {
                let string = '';
                model.filter(elem => {
                    return elem.visible;
                }).forEach(elem => {
                    let li = '<li>';
                    if (elem.isSelected) li = '<li class = selected>';
                    string += li + elem.title + '</li>';
                });
                this.ul.innerHTML = string;
            }
            init() {
                this.isLastSelected = null;
                this.preRender();
                this.render(this.model);
            }
        }


        function createItemsArr(num) {
            let arr = [];
            for (let i = 0; i < num; i++) {
               arr.push('element - ' + i);
            }
            return arr;
        }
            
        let items = createItemsArr(15);
        let list = new List(items, document.body.children[0]);
        let list1 = new List(items, document.body.children[0]);
        list.init();
        list1.init();

    </script>
</body>
</html>