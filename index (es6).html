<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Document</title>
    <style>
    	ul {
    		border-bottom: 1px solid rgb(200,200,200);
    	}
        ul li {
            cursor: default;
            user-select: none;
            list-style-type: none;
        }
        .selected {
            background-color: #FF9700;
        }
        input {
			padding: 5px 10px;
			border-radius: 5px;
			border-style: solid;
			border-width: 1px;
			margin-right: 5px;
        }
        input:focus {
        	outline: none;
        	box-shadow: 0 0 3px rgb(30,30,30) inset;
        }
        input[type="text"] {
			margin-right: 10px;
        }
        
    </style>
</head>
<body>
    <div id="container">

    </div>
    <script>
           'use strict';
            let create = document.createElement.bind(document);
            class List {
                constructor(items, conatainer) {
                    this.container = container;
                    this.createModel(items);
                }
                createModel(data) {
                	this.model = [];
                	data.forEach(elem => {
                		this.model.push(elem)
                	});
                }
                // model methods
                getData() {
                    return this.model;
                }
                addData(data) {
                	if (data) {
                		this.model.push(data);
                		return true;
                	} else return false;
                }
                removeData() {
                	let arr = this.model;
                	this.selected.forEach(elem => {
                		console.log(elem);
                		this.model.splice(elem, 1);
                	})
                }
                selectData(elem) {
                	this.selected.push(elem);
                }
                cancelSelection(elem) {
                	this.selected.splice(this.selected.indexOf(elem), 1);
                }
                cancelSelectiontAll() {
                	this.selected = [];
                }
                // controller
                actionHandler(e) {
                	e.preventDefault();
                	if (e.target.tagName === 'LI') {
                		let listArr = [].slice.call(this.ul.children);
                		let targetIndex = listArr.indexOf(e.target);
                        if (e.shiftKey) {
                        	this.parseShiftClick(targetIndex);
		                } else if (e.ctrlKey) {
		                    this.parseCtrlClick(targetIndex);
		                } else {
		                    this.parseClick(targetIndex);
		                }
	                	this.mark(this.selected); 
		        	} else if (e.target === this.buttonAdd) {
	                	let result = this.addData(this.textBox.value);
	                	if (result) {
	                		this.render(this.model);
	                	}
	                } else if (e.target.getAttribute('value') === 'remove') {
	                	this.removeData();
	                	this.render(this.model);
	                	this.selected = [];
	                	this.lastSelected = null;
                	}
                }
                parseClick(clicked) {
                	this.cancelSelectiontAll();
                	this.selectData(clicked);
                	this.lastSelected = clicked;
                }
                parseCtrlClick(clicked) {
                	let isSelected = this.selected.some(elem => {return elem === clicked}); 
                	if (isSelected) {
                		this.cancelSelection(clicked);
                		this.lastSelected = null;
                	} else {
                		this.selectData(clicked);
                		this.lastSelected = clicked;
                	}
                }
                parseShiftClick(clicked) {
                	this.cancelSelectiontAll();
                	if (this.lastSelected !== null) {
                		let min = Math.min(this.lastSelected, clicked);
                		let max = Math.max(this.lastSelected, clicked);
                		for (let i = min; i <= max; i++) {
                			this.selectData(i);
                		}
                	} else {
                		this.lastSelected = clicked;
                		this.selectData(clicked);
                	}
                }
                // view methods
                mark(indexes) {
                	let selected = this.ul.querySelectorAll('.selected');
                	selected.forEach((item) => {
                		item.classList.remove('selected');
                	});
                	indexes.forEach((index) => {
                		let li = this.ul.querySelector('li:nth-child(' + (index + 1)  + ')');
                		li.classList.add('selected');
                	});
                }
                render(model) {
                	let string = '';
                	model.forEach((elem) => {
                		string += '<li>' + elem + '</li>';
                	});
                	this.ul.innerHTML = string;
                }
                init() {
                   this.ul = create('ul');
                   this.form = create('form');
                   this.textBox = create('input');
                   this.textBox.setAttribute('type', 'text');
                   this.buttonAdd = create('input');
                   this.buttonAdd.setAttribute('type', 'submit');
                   this.buttonAdd.setAttribute('value', 'add');
                   this.buttonRemove = create('input');
                   this.buttonRemove.setAttribute('type', 'button');
                   this.buttonRemove.setAttribute('value', 'remove');
                   this.render(this.model);
                   this.form.append(this.textBox, this.buttonAdd, this.buttonRemove);
                   this.container.append(this.form, this.ul);
                   this.ul.onclick = this.actionHandler.bind(this);
                   this.form.onclick = this.actionHandler.bind(this);
                   this.lastSelected = null;
                   this.selected = [];
                }
            }

        function createItemsArr(num) {
            let arr = [];
            for (let i = 0; i < num; i++) {
               arr.push('element - ' + i);
            }
            return arr;
        }
            
        let items = createItemsArr(15);
        let list = new List(items, document.body.children[0]);
        let list1 = new List(items, document.body.children[0]);
        list.init();
        list1.init();

    </script>
</body>
</html>